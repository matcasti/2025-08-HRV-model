---
title: "A Unified Probabilistic Framework for Non-Stationary Heart Rate Variability Analysis"
subtitle: "Modeling the Dynamic Evolution of Autonomic Control"
date-modified: today
execute: 
  echo: false
author: 
  - name: "Matías Castillo-Aguilar"
    email: m99castillo@gmail.com
    orcid: 0000-0001-7291-247X
format: 
  html: 
    fig-format: svg
    title-block-banner: true
    title-block-style: manuscript
    toc: true
    toc-location: right
  pdf: 
    fig-format: pdf
    fig-dpi: 500
    documentclass: article
fig-width: 8
fig-height: 6
editor_options: 
  chunk_output_type: console
---

## Introduction

The rhythm of the human heart, far from being a simple, constant beat, is a complex and dynamic signal reflecting the continuous interplay between an organism and its internal and external environments. The precise timing between successive heartbeats, measured as the R-R interval (RRi), is a primary non-invasive proxy for autonomic nervous system (ANS) activity. The analysis of variations in this interval, a discipline known as heart rate variability (HRV), has become a cornerstone for assessing cardiovascular health, stress responses, and overall physiological state. This variability arises from the coordinated actions of multiple regulatory systems, including the sympathetic and parasympathetic branches of the ANS, baroreflexes, and thermoregulatory mechanisms.

Despite its utility, a significant limitation of traditional HRV analysis is its reliance on time-domain or frequency-domain metrics derived from static, short-term data windows. While such methods may offer insights into a snapshot of a physiological state under controlled conditions, they are fundamentally ill-suited to capture the dynamic, non-stationary nature of RRi signals during physiological transitions or stress, such as exercise, cognitive tasks, or pharmacologic interventions. The implicit assumption of stationarity in these fixed-window approaches can obscure subtle, yet physiologically critical, shifts in heart rate and its underlying variability. Furthermore, these conventional analyses often fail to establish a direct mechanistic link between observed changes in HRV and the underlying physiological processes responsible for them. For instance, a generalized decrease in HRV may be interpreted as a withdrawal of parasympathetic tone but could also stem from a complex shift in the balance of different frequency components of autonomic modulation. Disentangling these potential causes necessitates a more sophisticated, unified modeling paradigm.

Attempts to address these limitations have been made using a variety of modeling approaches, but these have often fallen short. For instance, state-space models have shown promise in tracking the evolution of cardiac dynamics, but their complexity can make parameter estimation difficult and their physiological interpretability limited. While time-frequency analysis methods, such as wavelets, can successfully visualize the time-varying nature of spectral content, they typically do not provide a generative model for testing specific physiological hypotheses. Moreover, they often lack a principled way to separate structured physiological variability from unstructured noise. Other efforts have focused on non-linear dynamics and fractal analysis, but these models are often phenomenological, describing the properties of the signal without offering a clear, mechanistic link to the underlying physiology. Consequently, no existing model provides a unified, probabilistic framework that can simultaneously capture and mechanistically interpret changes in both the mean RRi and its multi-component variability.

To advance the field beyond these constraints, a new generation of statistical models is clearly needed. These models must transcend simple descriptive statistics to provide a unified framework that simultaneously captures the time-varying nature of both the mean heart rate and the dynamic evolution of its multi-timescale variability. Such a framework should explicitly address the non-stationarity inherent to physiological signals, obviating the need for arbitrary, fixed-length analysis windows. It must be capable of decomposing the signal into its distinct components, separating the gross, underlying trends in heart rate from the structured, oscillatory variability that represents physiological regulation. Crucially, the model's parameters should have a direct, interpretable link to specific physiological processes, such as autonomic tone, sympathetic-parasympathetic balance, and the dynamics of recovery. As a probabilistic framework, it should also provide a principled means of quantifying the uncertainty associated with all parameter estimates, moving beyond a reliance on point estimates to offer a more complete picture of the physiological state.

This paper presents a novel probabilistic framework for analyzing non-stationary RRi signals. Our approach directly confronts these challenges by formulating the RRi signal as a continuous stochastic process. This model decomposes the signal into a deterministic mean trajectory and a time-varying total standard deviation, both of which are constructed mechanistically. The model's key innovations include a mechanistic model for the mean RRi that uses a flexible double-logistic function to allow for the direct estimation of physiologically salient parameters, such as the magnitude of heart rate change and the timing of response and recovery. A core innovation is the explicit decomposition of the total signal variance into components representing structured, oscillatory variability and unstructured, residual noise, which is critical for understanding the sources of change in HRV. We generalize the traditional SDNN metric into a time-varying trajectory, which is also modeled using a logistic function analogous to that for the mean RRi, thereby capturing the dynamic suppression and recovery of total variability in a parsimonious manner. A crucial mathematical inversion within the framework ensures that the amplitude of the synthesized structured signal exactly matches the target SDNN trajectory at every time point, effectively decoupling the total magnitude of variability from its spectral composition and enabling more granular analysis. Finally, the model captures the dynamic allocation of power across different physiological frequency bands by modeling their proportions as a function of a smooth master controller, which allows for a detailed analysis of shifts in spectral balance during physiological transitions.

The primary objective of this study is to introduce and validate this novel probabilistic model for the analysis of non-stationary RRi signals. We aim to demonstrate that this framework provides a more robust, informative, and physiologically interpretable analysis of heart rate dynamics than traditional methods. We hypothesize that the model will accurately and robustly capture the complex, time-varying dynamics of both the mean RRi and its variability during transient physiological perturbations. We further propose that the model's parameters will yield enhanced mechanistic nuance into autonomic control and cardiovascular regulation, thereby serving as a superior tool for both clinical research and basic physiological investigation. Through this work, we seek to establish a new standard for the analysis of time-varying physiological signals.

```{r}
#| include: false
library(ggplot2)
library(data.table)
library(brms)
library(tidybayes)
library(rstan)

theme_set(
  new = theme_classic(base_size = 14) +
    theme(legend.position = "bottom")
)
```

# Methods

## Model Formulation

We model the R–R interval (RRi) signal, observed at a discrete set of time points $\{t_i\}_{i=1}^N$, as a probabilistic process. The model's central thesis is that the signal can be generated from two fundamental, time-varying trajectories: a deterministic mean, $\mu(t_i)$, and a total standard deviation, $\mathrm{SDNN}(t_i)$. This approach provides a principled framework for understanding the interplay between underlying physiological trends and the dynamics of heart rate variability. The complete observation model is defined by the Normal likelihood in @eq-full-likelihood.

$$
\mathrm{RRi}(t_i) \sim \mathcal{N}\big(\mu(t_i), \mathrm{SDNN}(t_i)\big)
$${#eq-full-likelihood}

The core of the model lies in the mechanistic construction of these two components from a shared set of underlying dynamic functions. The mean trajectory, $\mu(t_i)$, is a superposition of a smoothly varying baseline trend and a synthesized, structured noise signal, as shown in @eq-mean-model.

$$
\mu(t_i)
= \underbrace{\mathrm{RR}(t_i)}_{\substack{\text{Gross}\\\text{RRi Trend}}}
+
\underbrace{A(t_i) \cdot \sum_{j=1}^{J} p_j(t_i) \cdot S_j(t_i)}_{\substack{\text{Unit-Variance Structured Noise}}}
$${#eq-mean-model}

Here, $\mathrm{RR}(t_i)$ represents the gross, underlying heart period trajectory. The structured noise component is synthesized from a set of spectral oscillators, $S_j(t_i)$, which represent activity in different physiological frequency bands ($j=1,2,3$ for VLF, LF, and HF, respectively). These oscillators are weighted by time-varying proportions, $p_j(t_i)$. Their combined magnitude is controlled by an internal amplitude normalization factor, $A(t_i)$, which ensures this entire structured component has a standard deviation of exactly one at all times.

The model's second primary output, the $\mathrm{SDNN}(t_i)$ trajectory, represents the total instantaneous standard deviation of the RRi signal. By directly modeling this quantity and supplying it to the likelihood, the framework captures the complete time-dependent evolution of heart rate variability without needing to estimate a separate residual error term. This formulation facilitates a unified analysis that simultaneously captures phenomena in both the time and frequency domains, obviating the need for traditional sliding-window decompositions.

### Baseline Heart Period: $\mathrm{RR}(t_i)$

The $\mathrm{RR}(t_i)$ component quantifies the gross, underlying variations in the mean R–R interval. These fluctuations arise from short-term physiological regulatory processes, including changes in metabolic and cardiovascular demand and shifts in tonic autonomic drive. To capture these dynamics, this component is parameterized using a flexible double-logistic function, which yields interpretable "onset" and "recovery" parameters. This function, shown in @eq-rri-baseline-model, is particularly well-suited for modeling physiological responses to a transient perturbation like exercise.

$$
\mathrm{RR}(t_i) =
\underbrace{\alpha_r}_{\substack{\text{Resting RRi}}}
-
\underbrace{\beta_r \cdot \mathcal{D}_{1}(t_i)}_{\substack{\text{Perturbation-induced}\\\text{RRi Drop}}}
+
\underbrace{c_r \beta_r \cdot \mathcal{D}_{2}(t_i)}_{\substack{\text{Post-perturbation}\\\text{RRi Recovery}}}
$${#eq-rri-baseline-model}

In this formulation, $\alpha_r$ represents the initial, stable heart period, interpretable as the baseline vagal tone. The parameter $\beta_r$ signifies the magnitude of the decline in RRi induced by the perturbation. The fractional recovery amplitude is denoted by $c_r$, where $c_r \in [0, 1)$ indicates a partial recovery and $c_r > 1$ indicates an overshoot. The dynamics are driven by two logistic transition functions, $\mathcal{D}_{1}(t_i)$ and $\mathcal{D}_{2}(t_i)$, defined in @eq-logistic-components.

$$
\begin{aligned}
\mathcal{D}_{1}(t_i) &= \left(1+ e^{-\lambda (t_i - \tau)}\right)^{-1} \\
\mathcal{D}_{2}(t_i) &= \left(1+ e^{-\phi (t_i - \tau - \delta)}\right)^{-1}
\end{aligned}
$${#eq-logistic-components}

The shared timing parameters govern these transitions: $\tau$ is the inflection point (midpoint) of the initial decline, whose rate is controlled by $\lambda$. The second transition is offset from the first by a delay $\delta$. This delay is dynamically constrained to ensure the recovery point $\tau+\delta$ occurs within the observation window. The recovery rate is determined by $\phi$. This specific formulation directly estimates physiologically salient time points and magnitudes, facilitating enhanced mechanistic interpretation and improved comparability across different experimental conditions.

### Generative Model for Signal Variability

A key innovation of this framework is its generative approach to signal variability. Instead of treating variability as a residual property, the model explicitly defines and constructs the dynamic trajectory of the signal's total standard deviation.

#### Total Instantaneous Variability: $\mathrm{SDNN}(t_i)$

We generalize the conventional, static notion of SDNN (the standard deviation of normal-to-normal intervals) to a dynamic quantity, $\mathrm{SDNN}(t_i)$. In this framework, $\mathrm{SDNN}(t_i)$ represents the total instantaneous standard deviation of the RRi signal. It is the parameter that governs the dispersion of the Normal likelihood at each time point. By modeling this trajectory directly, we can capture how the overall "strength" of autonomic modulation and other sources of variability evolves over time. To maintain parsimony and enforce a strong theoretical link between changes in mean and variability, the $\mathrm{SDNN}(t_i)$ trajectory is modeled using the same double-logistic functional form as the baseline RRi, as defined in @eq-sdnn-model.

$$
\mathrm{SDNN}(t_i) =
\underbrace{\alpha_s}_{\substack{\text{Resting SDNN}}}
-
\underbrace{\beta_s \cdot \mathcal{D}_{1}(t_i)}_{\substack{\text{Perturbation-induced}\\\text{SDNN Drop}}}
+
\underbrace{c_s \beta_s \cdot \mathcal{D}_{2}(t_i)}_{\substack{\text{Post-perturbation}\\\text{SDNN Recovery}}}
$${#eq-sdnn-model}

Here, $\alpha_s$, $\beta_s$, and $c_s$ are analogous to their counterparts in the baseline model, representing the resting total SDNN, the magnitude of its suppression, and its fractional recovery, respectively. This trajectory shares the same timing parameters ($\tau, \delta, \lambda, \phi$) as the mean RRi, enforcing the strong physiological assumption that changes in the magnitude of variability are temporally coupled with changes in the mean heart period.

#### Internal Amplitude Normalization: $A(t_i)$

The model must synthesize a structured noise signal, let's call it $X(t_i) = A(t_i) \sum_{j=1}^J p_j(t_i) S_j(t_i)$, which contributes to the mean trajectory $\mu(t_i)$. A critical design choice is to separate the modeling of this signal's spectral shape from the modeling of its overall magnitude. The magnitude is governed entirely by the `SDNN(t)` trajectory. Therefore, we require the synthesized signal $X(t_i)$ to be normalized such that its variance is precisely equal to one at every time point. This requires a deterministic calculation for the internal scaling amplitude, $A(t_i)$.

By construction, the spectral oscillator signals $S_j(t_i)$ are standardized to have zero mean and unit variance ($\mathrm{Var}[S_j(t_i)] = 1$). Assuming they are approximately uncorrelated, the variance of their weighted sum is:

$$
\mathrm{Var}\left[\sum_{j=1}^J p_j(t_i) S_j(t_i)\right] \approx \sum_{j=1}^J p_j(t_i)^2 \mathrm{Var}[S_j(t_i)] = \sum_{j=1}^J p_j(t_i)^2
$$

The variance of the complete structured noise signal is then $\mathrm{Var}[X(t_i)] = A(t_i)^2 \sum_{j=1}^J p_j(t_i)^2$. To achieve our goal of unit variance, we set $\mathrm{Var}[X(t_i)] = 1$ and solve for $A(t_i)$, which yields the critical normalization formula in @eq-amplitude-inversion.

$$
A(t_i) = \frac{1}{\sqrt{\sum_{j=1}^J p_j(t_i)^2}}
$${#eq-amplitude-inversion}

This normalization is essential. It ensures that the component representing structured noise in @eq-mean-model is a pure, unit-variance process whose spectral character is determined by $p_j(t_i)$ but whose amplitude is fixed. The full, time-varying magnitude of variability is then introduced independently via the $\mathrm{SDNN}(t_i)$ term in the final likelihood (@eq-full-likelihood). This elegant separation allows the model to learn how the spectral composition of HRV changes, independent of simultaneous changes in its total power.

### Spectral Components

The spectral character of the structured noise is determined by the properties of the oscillator signals $S_j(t_i)$ and their time-varying weights $p_j(t_i)$.

#### Dynamic Frequency Band Proportions

The proportions $p_j(t_i)$ dictate how the unit variance of the structured noise is allocated across the different frequency bands at each moment. The model captures the evolution of these proportions as a smooth transition between two distinct spectral states: a baseline state ($\vec\pi_{\text{base}}$) and a perturbed state ($\vec\pi_{\text{pert}}$). The transition is orchestrated by a single master controller function, $C(t_i)$, as shown in the convex combination of @eq-pj-using-ct.

$$
\vec{p}(t_i) = (1 - C(t_i)) \cdot \vec\pi_{\text{base}} + C(t_i) \cdot \vec\pi_{\text{pert}}
$${#eq-pj-using-ct}

Here, $\vec\pi_{\text{base}}$ and $\vec\pi_{\text{pert}}$ are simplex vectors (their elements are non-negative and sum to one) that represent the characteristic spectral distributions at rest and during peak perturbation, respectively. To ensure efficient sampling, these vectors are not estimated directly but are constructed by transforming unconstrained real-valued parameters using the additive log-ratio (ALR) transformation, which is detailed in the parameterization section below. The master controller, $C(t_i)$, is itself built from the same logistic building blocks, as defined in @eq-master-controller.

$$
C(t_i) = \mathcal{D}_{1}(t_i) \cdot \left(1 - c_c \cdot \mathcal{D}_{2}(t_i)\right)
$${#eq-master-controller}

This function naturally transitions from 0 (at baseline) towards 1 (during perturbation). The parameter $c_c$ allows for an incomplete spectral recovery, mirroring the flexibility of the mean and SDNN trajectories.

#### Multi-Sine Spectral Oscillators

To create a realistic spectral texture, each oscillator $S_j(t_i)$ is constructed as a superposition of $K_j$ distinct sinusoids within its designated frequency band. The un-normalized signal for band $j$, denoted $S'_j(t_i)$, is given by @eq-multi-sine-fun.

$$
S'_j(t_i) = \sum_{k=1}^{K_j} a_{j,k} \sin(2 \pi f_{j,k} t_i + \phi_{j,k})
$${#eq-multi-sine-fun}

The frequencies $f_{j,k}$ (in Hz) and phases $\phi_{j,k}$ are pre-specified. The amplitudes, $a_{j,k}$, follow a power-law relationship with frequency, $a_{j,k} \propto f_{j,k}^{-b/2}$, where $b$ is a shared spectral exponent. Finally, each composite signal $S'_j(t_i)$ undergoes empirical standardization to produce the final normalized oscillator signal, $S_j(t_i)$, with mean zero and unit variance.

### Model Parameterization and Priors

To ensure numerical stability and efficient sampling, all model parameters are estimated on an unconstrained real-valued scale ($\mathbb{R}$). Priors are placed on these unconstrained parameters, which are then transformed back to their constrained, physically meaningful scales within the model. This section details these transformations.

#### Timing, Rate, and Recovery Parameters

Parameters constrained to a specific interval, such as probabilities or proportions of a range, are parameterized on the logit scale, while parameters constrained to be positive are parameterized on the log scale. For the timing parameters, the onset time $\tau$ is mapped to the observed time interval $[t_{\text{min}}, t_{\text{max}}]$, and the subsequent delay $\delta$ is mapped to the remaining time $[0, t_{\text{max}} - \tau]$.

$$
\tau = \text{inv\_logit}(\tau_{\text{logit}}) \cdot (t_{\text{max}} - t_{\text{min}}) + t_{\text{min}} \\
\delta = \text{inv\_logit}(\delta_{\text{logit}}) \cdot (t_{\text{max}} - \tau)
$$

Similarly, the positive rate parameters $\lambda$ and $\phi$ are log-transformed to allow them to be estimated on an unconstrained scale.

$$
\lambda = \exp(\lambda_{\text{log}}) \quad ; \quad \phi = \exp(\phi_{\text{log}})
$$

Finally, the recovery coefficients for RR, SDNN, and the master controller ($c_r, c_s, c_c$) are mapped via a scaled logit transformation to the intervals $[0, 2]$ and $[0, 1]$, respectively.

$$
c_r = \text{inv\_logit}(c_{r, \text{logit}}) \cdot 2 \quad ; \quad c_s = \text{inv\_logit}(c_{s, \text{logit}}) \cdot 2 \quad ; \quad c_c = \text{inv\_logit}(c_{c, \text{logit}})
$$

#### Magnitude Parameters ($\alpha, \beta$)

The baseline and drop magnitudes are scaled relative to data-derived quantities to create dimensionless parameters whose priors are easier to specify and interpret. The RR magnitudes, $\alpha_r$ and $\beta_r$, are parameterized relative to the observed range of the data and the estimated baseline, respectively.

$$
\alpha_r = \text{inv\_logit}(\alpha_{r, \text{logit}}) \cdot 2 \cdot \text{rr\_range} + \text{rr\_min} \\
\beta_r = \text{inv\_logit}(\beta_{r, \text{logit}}) \cdot \alpha_r
$$

In the same manner, the SDNN magnitudes, $\alpha_s$ and $\beta_s$, are parameterized relative to the overall standard deviation of the data and the estimated baseline variability.

$$
\alpha_s = \text{inv\_logit}(\alpha_{s, \text{logit}}) \cdot \text{rr\_sd} \\ 
\beta_s = \text{inv\_logit}(\beta_{s, \text{logit}}) \cdot \alpha_s
$$

#### Spectral Proportion Parameters (ALR Transformation)

Directly placing a prior on a simplex (a vector of positive numbers that sum to one) can be inefficient for sampling. We use the additive log-ratio (ALR) transformation to map the 3-dimensional simplex vectors $\vec\pi$ to 2-dimensional unconstrained real vectors $\vec{y} = [y_1, y_2]$. Choosing the third component as the reference, the transformation is:

$$
y_1 = \log\left(\frac{\pi_1}{\pi_3}\right) \quad ; \quad y_2 = \log\left(\frac{\pi_2}{\pi_3}\right)
$$

The model estimates the unconstrained vectors $\vec{y}_{\text{base, log}}$ and $\vec{y}_{\text{pert, log}}$. These are mapped back to the simplex scale using the inverse transformation:

$$
\pi_1 = \frac{e^{y_1}}{1 + e^{y_1} + e^{y_2}} \quad ; \quad \pi_2 = \frac{e^{y_2}}{1 + e^{y_1} + e^{y_2}} \quad ; \quad \pi_3 = \frac{1}{1 + e^{y_1} + e^{y_2}}
$$

Weakly informative Normal priors are placed on the unconstrained logit, log, and ALR-transformed parameters, chosen to reflect plausible physiological assumptions (e.g., centering the spectral exponent $b$ around 1 for pink noise).

# Results

[...].

# Discussion

[...].
