<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matías Castillo-Aguilar">
<meta name="author" content="Cristian Núñez-Espinosa">

<title>A Unified Probabilistic Framework for Non-Stationary Heart Rate Variability Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A Unified Probabilistic Framework for Non-Stationary Heart Rate Variability Analysis</h1>
            <p class="subtitle lead">Modeling the Dynamic Evolution of Autonomic Control</p>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
        
        <div class="quarto-title-meta">

                <div>
            <div class="quarto-title-meta-heading">Authors</div>
            <div class="quarto-title-meta-contents">
                        <p>Matías Castillo-Aguilar <a href="mailto:matias.castillo@umag.cl" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0001-7291-247X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
                        <p>Cristian Núñez-Espinosa <a href="mailto:cristian.nunez@umag.cl" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-9896-7062" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
                      </div>
          </div>
                
          
                <div>
            <div class="quarto-title-meta-heading">Modified</div>
            <div class="quarto-title-meta-contents">
              <p class="date-modified">September 7, 2025</p>
            </div>
          </div>
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      <div class="quarto-alternate-formats"><div class="quarto-title-meta-heading">Other Formats</div><div class="quarto-title-meta-contents"><p><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></p></div></div></div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#model-formulation" id="toc-model-formulation" class="nav-link" data-scroll-target="#model-formulation">Model formulation</a>
  <ul class="collapse">
  <li><a href="#baseline-heart-period-and-total-variability-trajectories" id="toc-baseline-heart-period-and-total-variability-trajectories" class="nav-link" data-scroll-target="#baseline-heart-period-and-total-variability-trajectories">Baseline heart period and total variability trajectories</a></li>
  <li><a href="#generative-model-for-the-structured-signal" id="toc-generative-model-for-the-structured-signal" class="nav-link" data-scroll-target="#generative-model-for-the-structured-signal">Generative model for the structured signal</a></li>
  <li><a href="#model-parameterization-and-priors" id="toc-model-parameterization-and-priors" class="nav-link" data-scroll-target="#model-parameterization-and-priors">Model Parameterization and Priors</a></li>
  </ul></li>
  <li><a href="#simulation-studies" id="toc-simulation-studies" class="nav-link" data-scroll-target="#simulation-studies">Simulation Studies</a>
  <ul class="collapse">
  <li><a href="#time-domain-trajectory-reconstruction" id="toc-time-domain-trajectory-reconstruction" class="nav-link" data-scroll-target="#time-domain-trajectory-reconstruction">Time-domain trajectory reconstruction</a></li>
  <li><a href="#spectral-dynamics-reconstruction" id="toc-spectral-dynamics-reconstruction" class="nav-link" data-scroll-target="#spectral-dynamics-reconstruction">Spectral dynamics reconstruction</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#model-validation-and-parameter-recovery-on-synthetic-data" id="toc-model-validation-and-parameter-recovery-on-synthetic-data" class="nav-link" data-scroll-target="#model-validation-and-parameter-recovery-on-synthetic-data">Model validation and parameter recovery on synthetic data</a></li>
  <li><a href="#superiority-of-the-generative-model-over-conventional-windowed-methods" id="toc-superiority-of-the-generative-model-over-conventional-windowed-methods" class="nav-link" data-scroll-target="#superiority-of-the-generative-model-over-conventional-windowed-methods">Superiority of the generative model over conventional windowed methods</a></li>
  <li><a href="#application-to-an-empirical-dataset" id="toc-application-to-an-empirical-dataset" class="nav-link" data-scroll-target="#application-to-an-empirical-dataset">Application to an empirical dataset</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#methodological-superiority-and-the-abandonment-of-stationarity" id="toc-methodological-superiority-and-the-abandonment-of-stationarity" class="nav-link" data-scroll-target="#methodological-superiority-and-the-abandonment-of-stationarity">Methodological superiority and the abandonment of stationarity</a></li>
  <li><a href="#physiological-and-clinical-significance-of-the-models-parameters" id="toc-physiological-and-clinical-significance-of-the-models-parameters" class="nav-link" data-scroll-target="#physiological-and-clinical-significance-of-the-models-parameters">Physiological and clinical significance of the model’s parameters</a></li>
  <li><a href="#limitations-and-considerations-for-future-work" id="toc-limitations-and-considerations-for-future-work" class="nav-link" data-scroll-target="#limitations-and-considerations-for-future-work">Limitations and considerations for future work</a></li>
  <li><a href="#future-directions" id="toc-future-directions" class="nav-link" data-scroll-target="#future-directions">Future directions</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  <li><a href="#author-contributions" id="toc-author-contributions" class="nav-link" data-scroll-target="#author-contributions">Author Contributions</a></li>
  <li><a href="#funding" id="toc-funding" class="nav-link" data-scroll-target="#funding">Funding</a></li>
  <li><a href="#data-availability-statement" id="toc-data-availability-statement" class="nav-link" data-scroll-target="#data-availability-statement">Data availability statement</a></li>
  <li><a href="#conflicts-of-interests" id="toc-conflicts-of-interests" class="nav-link" data-scroll-target="#conflicts-of-interests">Conflicts of interests</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



  


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The rhythm of the human heart, far from being a simple, constant beat, is a complex and dynamic signal reflecting the continuous interplay between an organism and its internal and external environments. The precise timing between successive heartbeats, measured as the R-R interval (RRi), is a primary non-invasive proxy for autonomic nervous system (ANS) activity. The analysis of variations in this interval, a discipline known as heart rate variability (HRV), has become a cornerstone for assessing cardiovascular health, stress responses, and overall physiological state. This variability arises from the coordinated actions of multiple regulatory systems, including the sympathetic and parasympathetic branches of the ANS, baroreflexes, and thermoregulatory mechanisms.</p>
<p>Despite its utility, a significant limitation of traditional HRV analysis is its reliance on time-domain or frequency-domain metrics derived from static, short-term data windows. While such methods may offer insights into a snapshot of a physiological state under controlled conditions, they are fundamentally ill-suited to capture the dynamic, non-stationary nature of RRi signals during physiological transitions or stress. The implicit assumption of stationarity in these fixed-window approaches can obscure subtle, yet physiologically critical, shifts in heart rate and its underlying variability. Furthermore, these conventional analyses often fail to establish a direct mechanistic link between observed changes in HRV and the underlying physiological processes responsible for them.</p>
<p>While various modeling approaches have attempted to address these limitations, they often fall short. For instance, state-space models have shown promise in tracking the evolution of cardiac dynamics, but their complexity can make parameter estimation difficult and their physiological interpretability limited. Time-frequency analysis methods, such as wavelets, can successfully visualize the time-varying nature of spectral content, but they typically do not provide a generative model for testing specific physiological hypotheses. Consequently, no existing model provides a unified, probabilistic framework that can simultaneously capture and mechanistically interpret changes in both the mean RRi and its multi-component variability.</p>
<p>To advance the field beyond these constraints, a new generation of statistical models is clearly needed. A framework capable of surpassing these barriers should, at a minimum, satisfy four critical criteria. First, it must explicitly address the non-stationarity inherent to physiological signals, obviating the need for arbitrary analysis windows. Second, it must be capable of mechanistically decomposing the signal into its distinct components: a gross, underlying trend in heart rate and the structured, oscillatory variability that represents physiological regulation. Third, its parameters should have a direct, interpretable link to specific physiological processes, such as autonomic tone and recovery dynamics. Finally, as a probabilistic framework, it must provide a principled means of quantifying uncertainty for all estimates, moving beyond a reliance on simple point estimates.</p>
<p>To meet these challenges, we therefore propose a novel probabilistic framework. Here, we introduce a model designed to directly confront non-stationarity by treating the RRi signal as a continuous stochastic process. This framework is built to mechanistically decompose the signal into its constituent parts, including a baseline trend and its structured variability. Its core components are defined by flexible functions whose parameters are intended to provide direct physiological insight into response and recovery dynamics. Finally, we will demonstrate how its implementation as a fully Bayesian model yields the robust uncertainty quantification required of a modern analytical framework.</p>
<p>This study introduces and validates a novel probabilistic model for analyzing non-stationary RRi signals. We test the central hypothesis that this framework provides a more robust, informative, and physiologically interpretable analysis of heart rate dynamics than traditional methods. Specifically, we demonstrate its ability to accurately capture transient perturbations and show that its parameters offer enhanced mechanistic nuance into autonomic control. Through this work, we seek to establish a new standard for the analysis of dynamic physiological signals.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="model-formulation" class="level2">
<h2 class="anchored" data-anchor-id="model-formulation">Model formulation</h2>
<p>We present a comprehensive generative model for the RRi signal, observed at a discrete set of time points <span class="math inline">\(\{t_i\}_{i=1}^N\)</span>. The model’s architecture is designed to deconstruct the signal into its constituent physiological components, providing a mechanistic account of the processes that shape heart rate dynamics. This is achieved by conceptualizing the signal as a probabilistic process controlled by a time-varying mean, <span class="math inline">\(\mu(t_i)\)</span>, and a partitioned, time-varying standard deviation. This sophisticated approach moves beyond simple curve-fitting to formalize a theory of autonomic control and its temporal evolution.</p>
<p>The cornerstone of the model is the partitioning of the total signal variance into two distinct, time-dependent components: a structured variance, <span class="math inline">\(\sigma^2_{\text{struct}}(t_i)\)</span>, which captures the physiologically meaningful, oscillatory patterns of HRV, and a residual variance, <span class="math inline">\(\sigma^2_{\text{resid}}(t_i)\)</span>, which accounts for unstructured, moment-to-moment fluctuations or measurement noise. The complete observation model, which integrates these components, is defined by the Normal likelihood in <a href="#eq-full-likelihood" class="quarto-xref">Equation&nbsp;1</a>.</p>
<p><span id="eq-full-likelihood"><span class="math display">\[
\mathrm{RRi}(t_i) \sim \mathcal{N}\left(\mu(t_i), \sigma_{\text{resid}}(t_i)\right)
\tag{1}\]</span></span></p>
<p>The core of the model lies in the construction of the mean and variance components from a shared set of underlying dynamic functions. The mean trajectory, <span class="math inline">\(\mu(t_i)\)</span>, is a superposition of a smoothly varying baseline trend and the synthesized structured signal itself, as shown in <a href="#eq-mean-model" class="quarto-xref">Equation&nbsp;2</a>.</p>
<p><span id="eq-mean-model"><span class="math display">\[
\mu(t_i)
= \underbrace{\mathrm{RR_{base}}(t_i)}_{\substack{\text{Gross}\\\text{RRi Trend}}}
+
\underbrace{A(t_i) \cdot \sum_{j=1}^{J} p_j(t_i) \cdot S_j(t_i)}_{\substack{\text{Structured Variability Signal}}}
\tag{2}\]</span></span></p>
<p>Here, <span class="math inline">\(\mathrm{RR_{base}}(t_i)\)</span> represents the gross, underlying heart period trajectory. The structured variability signal is synthesized from a set of dynamically evolving spectral oscillators, <span class="math inline">\(S_j(t_i)\)</span>, which represent activity in different physiological frequency bands (<span class="math inline">\(j=1,2,3\)</span> for VLF, LF, and HF, respectively). These oscillators are weighted by time-varying proportions, <span class="math inline">\(p_j(t_i)\)</span>, and their overall magnitude is controlled by a scaling amplitude, <span class="math inline">\(A(t_i)\)</span>, which is deterministically calculated to ensure the signal’s variance matches the target structured variance, <span class="math inline">\(\sigma^2_{\text{struct}}(t_i)\)</span>.</p>
<p>A pivotal feature is a dynamic trajectory for the total signal variability, denoted <span class="math inline">\(\mathrm{SDNN}(t_i)\)</span>, which is then partitioned into its structured and residual components. This partition is controlled by a parameter, <span class="math inline">\(w \in [0, 1]\)</span>, which represents the fraction of total variance attributable to the structured component, as defined in <a href="#eq-var-structure" class="quarto-xref">Equation&nbsp;3</a>.</p>
<p><span id="eq-var-structure"><span class="math display">\[
\begin{aligned}
\sigma^2_{\text{struct}}(t_i) &amp;= w \cdot \mathrm{SDNN}(t_i)^2 \\
\sigma^2_{\text{resid}}(t_i) &amp;= (1-w) \cdot \mathrm{SDNN}(t_i)^2
\end{aligned}
\tag{3}\]</span></span></p>
<p>This formulation allows the model to simultaneously learn not only how the total amount of HRV changes over time (via <span class="math inline">\(\mathrm{SDNN}(t_i)\)</span>), but also how the nature of that variability evolves, that is, the balance between predictable, oscillatory patterns and unpredictable noise (via <span class="math inline">\(w\)</span>). This unified analysis facilitates a deeper understanding of autonomic regulation by capturing phenomena across both time and frequency domains within a single, coherent inferential framework.</p>
<section id="baseline-heart-period-and-total-variability-trajectories" class="level3">
<h3 class="anchored" data-anchor-id="baseline-heart-period-and-total-variability-trajectories">Baseline heart period and total variability trajectories</h3>
<p>The model posits that the primary trends in both the mean heart period and its total variability are driven by a common underlying physiological response to a stimulus. To capture this, both the <span class="math inline">\(\mathrm{RR_{base}}(t_i)\)</span> and <span class="math inline">\(\mathrm{SDNN}(t_i)\)</span> trajectories are parameterized using the same flexible double-logistic functional form.</p>
<p>The baseline heart period, <span class="math inline">\(\mathrm{RR_{base}}(t_i)\)</span>, which quantifies the gross, underlying variations in the mean R–R interval, is defined in <a href="#eq-rri-baseline-model" class="quarto-xref">Equation&nbsp;4</a>.</p>
<p><span id="eq-rri-baseline-model"><span class="math display">\[
\mathrm{RR_{base}}(t_i) =
\underbrace{\alpha_r}_{\substack{\text{Resting RRi}}}
-
\underbrace{\beta_r \cdot \mathcal{D}_{1}(t_i)}_{\substack{\text{Perturbation-induced}\\\text{RRi Drop}}}
+
\underbrace{c_r \beta_r \cdot \mathcal{D}_{2}(t_i)}_{\substack{\text{Post-perturbation}\\\text{RRi Recovery}}}
\tag{4}\]</span></span></p>
<p>In this formulation, <span class="math inline">\(\alpha_r\)</span> represents the initial, stable heart period. The parameter <span class="math inline">\(\beta_r\)</span> signifies the magnitude of the decline in RRi induced by the perturbation. The fractional recovery amplitude is denoted by <span class="math inline">\(c_r\)</span>, where <span class="math inline">\(c_r &gt; 1\)</span> indicates an overshoot.</p>
<p>Concurrently, the total instantaneous variability, <span class="math inline">\(\mathrm{SDNN}(t_i)\)</span>, follows a parallel dynamic trajectory, as defined in <a href="#eq-sdnn-model" class="quarto-xref">Equation&nbsp;5</a>.</p>
<p><span id="eq-sdnn-model"><span class="math display">\[
\mathrm{SDNN}(t_i) =
\underbrace{\alpha_s}_{\substack{\text{Resting SDNN}}}
-
\underbrace{\beta_s \cdot \mathcal{D}_{1}(t_i)}_{\substack{\text{Perturbation-induced}\\\text{SDNN Drop}}}
+
\underbrace{c_s \beta_s \cdot \mathcal{D}_{2}(t_i)}_{\substack{\text{Post-perturbation}\\\text{SDNN Recovery}}}
\tag{5}\]</span></span></p>
<p>Here, <span class="math inline">\(\alpha_s\)</span>, <span class="math inline">\(\beta_s\)</span>, and <span class="math inline">\(c_s\)</span> are analogous to their counterparts in the baseline model, representing the resting total SDNN, the magnitude of its suppression, and its fractional recovery, respectively. The dynamics for both trajectories are driven by a shared pair of logistic transition functions, <span class="math inline">\(\mathcal{D}_{1}(t_i)\)</span> and <span class="math inline">\(\mathcal{D}_{2}(t_i)\)</span>, defined in <a href="#eq-logistic-components" class="quarto-xref">Equation&nbsp;6</a>.</p>
<p><span id="eq-logistic-components"><span class="math display">\[
\begin{aligned}
\mathcal{D}_{1}(t_i) &amp;= \left(1+ e^{-\lambda (t_i - \tau)}\right)^{-1} \\
\mathcal{D}_{2}(t_i) &amp;= \left(1+ e^{-\phi (t_i - \tau - \delta)}\right)^{-1}
\end{aligned}
\tag{6}\]</span></span></p>
<p>The shared timing parameters enforce a strong physiological coupling: <span class="math inline">\(\tau\)</span> is the inflection point of the initial response, with rate <span class="math inline">\(\lambda\)</span>. The second transition, representing recovery, is offset by a delay <span class="math inline">\(\delta\)</span> and proceeds at a rate <span class="math inline">\(\phi\)</span>. This shared structure ensures that changes in the magnitude of variability are temporally synchronized with changes in the mean heart period, while still allowing their relative magnitudes and recovery profiles to differ.</p>
</section>
<section id="generative-model-for-the-structured-signal" class="level3">
<h3 class="anchored" data-anchor-id="generative-model-for-the-structured-signal">Generative model for the structured signal</h3>
<p>The structured component of the signal is where the model’s spectral properties are defined. Its construction involves three key elements: the dynamic spectral proportions, the latent spectral oscillators, and the deterministic amplitude inversion that ties them to the target variance.</p>
<section id="dynamic-frequency-band-proportions" class="level4">
<h4 class="anchored" data-anchor-id="dynamic-frequency-band-proportions">Dynamic frequency band proportions</h4>
<p>The proportions <span class="math inline">\(p_j(t_i)\)</span> dictate how the total structured variance, <span class="math inline">\(\sigma^2_{\text{struct}}(t_i)\)</span>, is allocated across the different frequency bands at each moment. The model captures the evolution of these proportions as a smooth transition between two distinct spectral states: a baseline state (<span class="math inline">\(\vec\pi_{\text{base}}\)</span>) and a perturbed state (<span class="math inline">\(\vec\pi_{\text{pert}}\)</span>). The transition is orchestrated by a single master controller function, <span class="math inline">\(C(t_i)\)</span>, as shown in the convex combination of <a href="#eq-pj-using-ct" class="quarto-xref">Equation&nbsp;7</a>.</p>
<p><span id="eq-pj-using-ct"><span class="math display">\[
\vec{p}(t_i) = (1 - C(t_i)) \cdot \vec\pi_{\text{base}} + C(t_i) \cdot \vec\pi_{\text{pert}}
\tag{7}\]</span></span></p>
<p>Here, <span class="math inline">\(\vec\pi_{\text{base}}\)</span> and <span class="math inline">\(\vec\pi_{\text{pert}}\)</span> are simplex vectors representing the characteristic spectral distributions at rest and during peak perturbation. The master controller, <span class="math inline">\(C(t_i)\)</span>, is itself built from the same logistic building blocks, ensuring the spectral transition is synchronized with the primary physiological response, as defined in <a href="#eq-master-controller" class="quarto-xref">Equation&nbsp;8</a>.</p>
<p><span id="eq-master-controller"><span class="math display">\[
C(t_i) = \mathcal{D}_{1}(t_i) \cdot \left(1 - c_c \cdot \mathcal{D}_{2}(t_i)\right)
\tag{8}\]</span></span></p>
<p>This function naturally transitions from 0 towards 1, with the parameter <span class="math inline">\(c_c \in [0, 1]\)</span> allowing for an incomplete spectral recovery.</p>
</section>
<section id="latent-multi-sine-spectral-oscillators" class="level4">
<h4 class="anchored" data-anchor-id="latent-multi-sine-spectral-oscillators">Latent multi-sine spectral oscillators</h4>
<p>The model explicitly learns the phase and amplitude of the underlying spectral components from the data. Each oscillator, <span class="math inline">\(S_j(t_i)\)</span>, is constructed as a superposition of <span class="math inline">\(K_j\)</span> sinusoids with pre-specified frequencies but with unknown amplitudes. The signal for band <span class="math inline">\(j\)</span> is given by <a href="#eq-multi-sine-fun" class="quarto-xref">Equation&nbsp;9</a>.</p>
<p><span id="eq-multi-sine-fun"><span class="math display">\[
S_j(t_i) = \sum_{k=1}^{K_j} \left[ u_{j,k}^{(\sin)} \sin(2 \pi f_{j,k} t_i) + u_{j,k}^{(\cos)} \cos(2 \pi f_{j,k} t_i) \right]
\tag{9}\]</span></span></p>
<p>The coefficients <span class="math inline">\(u_{j,k}^{(\sin)}\)</span> and <span class="math inline">\(u_{j,k}^{(\cos)}\)</span> are the unknown amplitudes for the sine and cosine components at each frequency <span class="math inline">\(f_{j,k}\)</span>. To ensure a realistic spectral structure and aid inference, we place a hierarchical prior on these coefficients. This is achieved using a non-centered parameterization, where the coefficients are modeled as draws from a Normal distribution whose standard deviation is frequency-dependent, as defined in <a href="#eq-hierarchical-prior-spectral" class="quarto-xref">Equation&nbsp;10</a>.</p>
<p><span id="eq-hierarchical-prior-spectral"><span class="math display">\[
u_{j,k}^{(\cdot)} \sim \mathcal{N}(0, \sigma_{u} \cdot a_{j,k})
\tag{10}\]</span></span></p>
<p>Here, the scale of the prior is determined by two components. First, <span class="math inline">\(a_{j,k}\)</span> imposes a power-law relationship with frequency, <span class="math inline">\(a_{j,k} = f_{j,k}^{-b/2}\)</span>, where <span class="math inline">\(b\)</span> is a global spectral exponent. This enforces a <span class="math inline">\(1/f^b\)</span> noise structure, a common characteristic of biological signals. Second, <span class="math inline">\(\sigma_{u}\)</span> is a single global scaling parameter that adjusts the overall power across all bands. Finally, after construction, each oscillator signal <span class="math inline">\(S_j(t_i)\)</span> is mean-centered to ensure it represents pure variability.</p>
</section>
<section id="deterministic-amplitude-inversion" class="level4">
<h4 class="anchored" data-anchor-id="deterministic-amplitude-inversion">Deterministic amplitude inversion</h4>
<p>The final step is to ensure that the synthesized structured signal, <span class="math inline">\(X(t_i) = A(t_i) \sum_{j=1}^J p_j(t_i) S_j(t_i)\)</span>, has a variance equal to the target structured variance, <span class="math inline">\(\sigma^2_{\text{struct}}(t_i)\)</span>, at every time point. A key feature of this model is that it does not assume the sinusoids form an orthogonal basis over the discrete, finite time domain. Instead, it computes the exact sample variance for each synthesized oscillator, <span class="math inline">\(\mathrm{Var}[S_j(t_i)]\)</span>, given the current values of its coefficients.</p>
<p>Let <span class="math inline">\(\mathbf{\Sigma}_S\)</span> be the diagonal <span class="math inline">\(3 \times 3\)</span> matrix whose entries are these computed variances, <span class="math inline">\(\mathbf{\Sigma}_S[j, j] = \mathrm{Var}[S_j(t_i)]\)</span>. Assuming independence between the bands, the variance of the weighted sum is given by the quadratic form in <a href="#eq-weighted-sum" class="quarto-xref">Equation&nbsp;11</a>.</p>
<p><span id="eq-weighted-sum"><span class="math display">\[
\mathrm{Var}\left[\sum_{j=1}^J p_j(t_i) S_j(t_i)\right] = \vec{p}(t_i)^\top \mathbf{\Sigma}_S \; \vec{p}(t_i)
\tag{11}\]</span></span></p>
<p>The variance of the complete structured signal is <span class="math inline">\(\mathrm{Var}[X(t_i)] = A(t_i)^2 \cdot \left(\vec{p}(t_i)^\top \mathbf{\Sigma}_S \; \vec{p}(t_i)\right)\)</span>. To match our target, we set this equal to <span class="math inline">\(\sigma^2_{\text{struct}}(t_i) = w \cdot \mathrm{SDNN}(t_i)^2\)</span>. Solving for <span class="math inline">\(A(t_i)\)</span> yields the critical inversion formula in <a href="#eq-amplitude-inversion" class="quarto-xref">Equation&nbsp;12</a>.</p>
<p><span id="eq-amplitude-inversion"><span class="math display">\[
A(t_i) = \frac{\sqrt{w} \cdot \mathrm{SDNN}(t_i)}{\sqrt{\vec{p}(t_i)^\top \mathbf{\Sigma}_S \; \vec{p}(t_i)}}
\tag{12}\]</span></span></p>
<p>This inversion is essential. It dynamically adjusts the amplitude of the synthesized spectral signal to ensure its contribution to the total variance is exactly as prescribed by the model’s high-level parameters (<span class="math inline">\(\mathrm{SDNN}(t_i)\)</span> and <span class="math inline">\(w\)</span>), thereby connecting the time-domain and frequency-domain components of the model.</p>
</section>
</section>
<section id="model-parameterization-and-priors" class="level3">
<h3 class="anchored" data-anchor-id="model-parameterization-and-priors">Model Parameterization and Priors</h3>
<p>To ensure numerical stability and efficient sampling, all model parameters are estimated on an unconstrained real-valued scale (<span class="math inline">\(\mathbb{R}\)</span>). Priors are placed on these unconstrained parameters, which are then transformed back to their constrained, physically meaningful scales within the model.</p>
<section id="timing-rate-and-magnitude-parameters" class="level4">
<h4 class="anchored" data-anchor-id="timing-rate-and-magnitude-parameters">Timing, Rate, and Magnitude Parameters</h4>
<p>Parameters constrained to a specific interval are parameterized on the logit scale, while positive parameters are on the log scale. For instance, the timing parameters <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\delta\)</span> are mapped to the observed time interval (<span class="math inline">\(t_\text{range}\)</span>) and the remaining time, respectively, using the inverse logit transformation, such that <span class="math inline">\(\tau = \text{logit}^{-1}(\tau_\text{logit}) \cdot t_\text{range} + t_\text{min}\)</span> and <span class="math inline">\(\delta = \text{logit}^{-1}(\delta_\text{logit}) \cdot (t_\text{range} - \tau)\)</span>.</p>
<p>The positive rate parameters <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\phi\)</span> are simply log-transformed, i.e., <span class="math inline">\(\lambda = \exp(\lambda_\text{log})\)</span>. The recovery coefficients for the time-domain components (<span class="math inline">\(c_r,c_s\)</span>) are mapped to the interval <span class="math inline">\([0, 2]\)</span>, while the recovery parameter for spectral components (<span class="math inline">\(c_c\)</span>) is mapped to the <span class="math inline">\([0, 1]\)</span> interval, using a scaled logit function, <span class="math inline">\(c = \text{logit}^{-1}(c_\text{logit}) \cdot \text{scale}\)</span>. Similarly, the fraction of structured variance, <span class="math inline">\(w\)</span>, is constrained between 0 and 1 via <span class="math inline">\(w = \text{logit}^{-1}(w_{\text{logit}})\)</span>.</p>
<p>The magnitude parameters (<span class="math inline">\(\alpha_r, \beta_r, \alpha_s, \beta_s\)</span>) are scaled relative to data-derived quantities to create dimensionless parameters whose priors are easier to specify. For instance, <span class="math inline">\(\alpha_r\)</span> is defined as <span class="math inline">\(\alpha_r = \text{logit}^{-1}(\alpha_{r, \text{logit}}) \cdot 2 \cdot \text{rr}_\text{range} + \text{rr}_\text{min}\)</span>, which then scales its corresponding <span class="math inline">\(\beta\)</span> parameter, <span class="math inline">\(\beta_r = \text{logit}^{-1}(\beta_{r, \text{logit}}) \cdot \alpha_r\)</span>. A similar relationship holds for <span class="math inline">\(\alpha_s\)</span> and <span class="math inline">\(\beta_s\)</span>, which are scaled by the data’s standard deviation. These transformations ensure the sampler explores a valid and well-behaved parameter space.</p>
</section>
<section id="spectral-and-oscillator-parameters" class="level4">
<h4 class="anchored" data-anchor-id="spectral-and-oscillator-parameters">Spectral and Oscillator Parameters</h4>
<p>The spectral proportions, <span class="math inline">\(\vec\pi_{\text{base}}\)</span> and <span class="math inline">\(\vec\pi_{\text{pert}}\)</span>, are mapped from the 3-dimensional simplex to 2-dimensional real vectors, <span class="math inline">\(\vec{y} = [y_1, y_2]\)</span>, using the additive log-ratio (ALR) transformation. The model estimates the unconstrained vectors (<span class="math inline">\(\vec{y}_{\text{base, log}}, \vec{y}_{\text{pert, log}}\)</span>), which are mapped back to the simplex via the softmax function.</p>
<p>To improve sampling efficiency, the oscillator amplitudes, <span class="math inline">\(u_{j,k}\)</span>, are handled with a non-centered parameterization. Instead of estimating the highly correlated <span class="math inline">\(u\)</span> values directly, the model estimates standard normal deviates, <span class="math inline">\(z_{j,k}\)</span>. These are then scaled by the hierarchical prior to construct the final amplitudes as <span class="math inline">\(u_{j,k} = z_{j,k} \cdot \sigma_{u} \cdot a_{j,k}\)</span>, where <span class="math inline">\(a_{j,k} = f_{j,k}^{-b/2}\)</span> is a frequency-dependent component and <span class="math inline">\(\sigma_u\)</span> is a global scale parameter. This technique dramatically reduces posterior correlations between parameters. Weakly informative priors are placed on all unconstrained parameters, allowing the data to drive the final inference.</p>
</section>
</section>
</section>
<section id="simulation-studies" class="level2">
<h2 class="anchored" data-anchor-id="simulation-studies">Simulation Studies</h2>
<p>To evaluate the model’s performance, we conducted a series of simulation studies. The objectives were to assess the model’s ability to recover known ground-truth parameters from synthetic data and to quantitatively benchmark its reconstruction of key HRV dynamics against conventional, windowed analysis techniques. Synthetic RRi time series were generated using the model’s own generative structure with pre-specified parameter values. This process provided datasets with perfectly known underlying dynamics for <span class="math inline">\(\mathrm{RR}(t_i)\)</span>, <span class="math inline">\(\mathrm{SDNN}(t_i)\)</span>, and <span class="math inline">\(p_j(t_i)\)</span>, serving as an objective gold standard for evaluation.</p>
<p>We designed three distinct scenarios to probe the model’s capabilities under diverse and challenging conditions. These scenarios: (1) a classic sympatho-vagal response, (2) an incomplete recovery with spectral persistence, and (3) a high noise with a stable spectrum, were chosen specifically to test the limitations inherent in standard analysis methods, these separate scenarios can be seen in Figure 1 and the parameters used to generate the data can be seen in Table 1. Each simulated dataset was analyzed with our full Bayesian model and, for comparison, with conventional techniques: a sliding-window analysis for time-domain metrics and a Short-Time Fourier Transform (STFT) for spectral dynamics.</p>
<p><img src="figures/fig-generated-data.svg" class="img-fluid" style="width:100.0%"></p>
<p><strong>Figure 1</strong>. Three scenarios simulated from the probabilistic model to assess the inference capabilities to recover the data generation process. The scenarios correspond to (A) a classic sympatho-vagal response, (B) an incomplete recovery with spectral persistence, and (C) a high noise with a stable spectrum. Subpanels indicate observed RRi signal with true component (<span class="math inline">\(\mu(t_i)\)</span>) highlighted, true underlying RRi trend and SDNN, next to spectral signature of the signal, depicting the relative contribution of each frequency band as a dynamic process.</p>
<p>&lt;&lt;Table 1&gt;&gt;</p>
<section id="time-domain-trajectory-reconstruction" class="level3">
<h3 class="anchored" data-anchor-id="time-domain-trajectory-reconstruction">Time-domain trajectory reconstruction</h3>
<p>The capacity to accurately capture time-domain dynamics was evaluated by comparing the model’s continuous estimates of <span class="math inline">\(\mathrm{RR}(t_i)\)</span> and <span class="math inline">\(\mathrm{SDNN}(t_i)\)</span> against the stepwise approximations derived from a standard sliding-window mean and standard deviation. To provide a comprehensive evaluation of reconstruction fidelity, model performance was quantified against the ground-truth trajectories using a suite of complementary metrics. The root mean squared error (RMSE) and mean absolute error (MAE) were used to measure the average magnitude of the estimation error, with MAE offering a more robust assessment against sporadic outliers. The model’s bias (mean error) was calculated to identify any systematic tendency for over- or underestimation. Finally, the coefficient of determination (<span class="math inline">\(R^2\)</span>) was used to assess the proportion of variance in the true signal captured by the estimate.</p>
</section>
<section id="spectral-dynamics-reconstruction" class="level3">
<h3 class="anchored" data-anchor-id="spectral-dynamics-reconstruction">Spectral dynamics reconstruction</h3>
<p>To evaluate the reconstruction of spectral dynamics, our model’s continuous estimates of the spectral proportions, <span class="math inline">\(p_j(t_i)\)</span>, were compared against those derived from an STFT. For a direct comparison, the spectrogram generated by the STFT was normalized at each time step to yield proportional power within the VLF, LF, and HF bands. The performance of both methods was then assessed by comparing their estimated trajectories to the known ground-truth proportions using the same comprehensive suite of metrics (RMSE, MAE, Bias, and <span class="math inline">\(R^2\)</span>). This comparative framework was designed to objectively quantify the trade-offs in temporal and frequency resolution inherent to windowed methods versus the continuous estimation provided by our model, especially in the presence of rapid transitions or low signal-to-noise ratios. As part of the model’s internal validation, we also confirmed that the 95% posterior credible intervals for all generative parameters consistently contained the known ground-truth values, ensuring both inferential accuracy and appropriate uncertainty quantification.</p>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<p>This section presents the performance and application of our novel generative model for RRi analysis. We first establish the model’s validity and accuracy through a series of simulation studies, demonstrating its ability to recover known ground-truth parameters with high fidelity. We then provide a direct quantitative comparison against conventional windowed analysis techniques, highlighting the superior temporal and spectral resolution of our approach. Finally, we apply the model to an empirical dataset from a physiological perturbation protocol to illustrate its capacity for yielding enhanced mechanistic insights into autonomic dynamics.</p>
<section id="model-validation-and-parameter-recovery-on-synthetic-data" class="level2">
<h2 class="anchored" data-anchor-id="model-validation-and-parameter-recovery-on-synthetic-data">Model validation and parameter recovery on synthetic data</h2>
<p>To verify the model’s correctness and inferential accuracy, we first applied it to synthetic RRi data generated with known underlying parameters. This allowed for a direct comparison between the model’s estimates and the ground-truth dynamics, providing a gold-standard validation of its performance.</p>
<p>Our model accurately reconstructs the full, continuous dynamics of the RRi signal. Figure 2 showcases the model’s performance on a representative simulation of a classic sympatho-vagal response. The top panels display the model’s posterior mean estimates for the baseline RRi trajectory (<span class="math inline">\(\mathrm{RR_{base}}(t)\)</span>) and the total variability trajectory (<span class="math inline">\(\mathrm{SDNN}(t)\)</span>). The estimates closely follow the true generative trajectories, and the 95% posterior credible intervals consistently envelop the ground truth, demonstrating both accuracy and uncertainty quantification. The bottom panel shows the corresponding reconstruction of the time-varying spectral proportions (<span class="math inline">\(p_j(t)\)</span>), where the model again successfully captures the rapid, dynamic shift from a HF dominant state at baseline to a VLF dominant state during the perturbation.</p>
<p>&lt;&lt;FIGURA 2&gt;&gt; <strong>Figure 2</strong>. Reconstruction of Synthetic Data. The model’s posterior estimates (solid lines) and 95% credible intervals (shaded ribbons) for the baseline RRi, total SDNN, and spectral proportions trajectories are shown overlaid on the known ground-truth dynamics (dashed lines). The model demonstrates high fidelity in capturing both time-domain and frequency-domain non-stationarities.</p>
<p>Beyond reconstructing the continuous trajectories, the model also accurately recovers the underlying mechanistic parameters that control them. Table 2 summarizes the posterior estimates for key generative parameters across all three challenging simulation scenarios. For critical parameters such as the timing of the response (<span class="math inline">\(\tau\)</span>), the recovery delay (<span class="math inline">\(\delta\)</span>), the magnitudes of the RRi and SDNN drops (<span class="math inline">\(\beta_r\)</span>, <span class="math inline">\(\beta_s\)</span>), and the fraction of structured variance (<span class="math inline">\(w\)</span>), the 95% credible intervals consistently contained the true values used for data generation. This robust performance across diverse conditions confirms the model’s ability to reliably estimate the interpretable parameters at the core of its design.</p>
<p>&lt;&lt;Table 2&gt;&gt;</p>
</section>
<section id="superiority-of-the-generative-model-over-conventional-windowed-methods" class="level2">
<h2 class="anchored" data-anchor-id="superiority-of-the-generative-model-over-conventional-windowed-methods">Superiority of the generative model over conventional windowed methods</h2>
<p>Having established the model’s validity, we next benchmarked its performance directly against traditional analysis techniques, specifically, sliding-window analysis for time-domain metrics and the Short-Time Fourier Transform (STFT) for spectral dynamics.</p>
<p>The model provides superior temporal resolution for time-domain dynamics. Conventional sliding-window methods inherently smooth and delay the detection of dynamic changes. Figure 3 illustrates this critical limitation by comparing the model’s instantaneous <span class="math inline">\(\mathrm{SDNN}(t)\)</span> estimate against that of a 60-second sliding window. While our model’s estimate precisely tracks the non-linear recovery phase of the ground-truth signal, the windowed approach produces a delayed, blunted, and stepwise approximation that obscures the true physiological dynamics. This demonstrates the model’s ability to overcome the core limitation of stationarity assumptions that plagues traditional methods.</p>
<p><img src="figures/fig-windowed-method.svg" class="img-fluid" style="width:100.0%"></p>
<p><strong>Figure 3</strong>. Time-Domain Reconstruction Comparison. The continuous, instantaneous estimate of the <span class="math inline">\(\mathrm{SDNN}(t)\)</span> trajectory from our model (blue) is compared against the stepwise approximation from a 60-second sliding-window analysis (orange). The model accurately captures the rapid recovery dynamic, whereas the windowed method introduces significant lag and artifactually smooths the transition.</p>
<p>The model resolves spectral dynamics without the time-frequency uncertainty trade-off. The STFT is fundamentally limited by the trade-off between temporal and frequency resolution. Our model provides a continuous, and accurate depiction of the switch from HF to VLF dominance. In contrast, the STFT spectrogram produces a smeared and indistinct representation, failing to precisely resolve either the timing or the magnitude of the spectral shift.</p>
<p>Quantitative analysis confirms the model’s superior accuracy. The visual advantages of our approach are supported by quantitative performance metrics. Table 3 presents the Root Mean Squared Error (RMSE) and coefficient of determination (<span class="math inline">\(R^2\)</span>) for our model versus conventional methods across all simulation scenarios. For both time-domain and spectral-domain reconstructions, our model consistently achieved a significantly lower RMSE and a higher <span class="math inline">\(R^2\)</span>, often by a substantial margin, particularly in scenarios involving rapid transitions or high noise. These results provide definitive evidence that the model’s window-free, generative approach yields a more accurate and faithful representation of heart rate dynamics.</p>
<p>&lt;&lt;Tabla 3&gt;&gt;</p>
</section>
<section id="application-to-an-empirical-dataset" class="level2">
<h2 class="anchored" data-anchor-id="application-to-an-empirical-dataset">Application to an empirical dataset</h2>
<p>To demonstrate the model’s utility in a real-world context, we applied it to an RRi series recorded from a healthy subject undergoing a cold pressor test, a potent sympatho-excitatory stimulus. This allows us to move beyond validation and showcase the model’s power for physiological discovery.</p>
<p>The model mechanistically decomposes the full autonomic response. Figure 4 presents the complete decomposition of the empirical RRi signal. The model reveals a multi-phasic response not easily captured by traditional metrics. Panel A shows the raw RRi data. Panel B illustrates the inferred <span class="math inline">\(\mathrm{RR_{base}}(t)\)</span> trajectory, quantifying a rapid initial tachycardia followed by a partial, slow recovery. Panel C reveals the dynamics of total variability (<span class="math inline">\(\mathrm{SDNN}(t)\)</span>), which shows a profound suppression that persists long after the mean RRi has begun to recover. Most critically, Panel D uncovers the underlying spectral shifts: the response is characterized by an almost complete withdrawal of parasympathetically-mediated HF power and a corresponding surge in sympathetically-mediated VLF power.</p>
<p><strong>Figure 4</strong>. Mechanistic Decomposition of an Empirical Cold Pressor Response. The model’s analysis of a real RRi signal. (A) Raw data. (B) Inferred baseline RRi trajectory. (C) Inferred total SDNN trajectory. (D) Inferred spectral proportion dynamics, showing a clear shift from HF to VLF dominance. Shaded regions are 95% credible intervals.</p>
<p>Model parameters provide novel, interpretable insights into recovery dynamics. The true power of the model lies in the physiological interpretation of its parameters. Figure 5 displays the posterior distributions for key recovery parameters. We found that the recovery of the mean RRi (<span class="math inline">\(c_r\)</span>) was significantly more complete than the recovery of total HRV (<span class="math inline">\(c_s\)</span>), suggesting a lingering sympathetic activation even after the heart rate has partially normalized. Furthermore, the spectral recovery parameter (<span class="math inline">\(c_c\)</span>) was near zero, indicating a profound “spectral persistence” where the VLF-dominant state remained long after the stimulus ended. Finally, the structured variance fraction (<span class="math inline">\(w\)</span>) was estimated to be high throughout, confirming that the observed variability was dominated by structured autonomic oscillations rather than noise. These parameters provide a nuanced, quantitative, and mechanistic narrative of the physiological response that is inaccessible with conventional analysis.</p>
<p>&lt;&lt;Figura 5&gt;&gt;</p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>The analysis of heart rate variability has long served as an indispensable tool for probing the complexities of the autonomic nervous system. However, the field has been persistently challenged by the non-stationary nature of physiological signals, a characteristic that fundamentally conflicts with the stationarity assumptions underpinning traditional analysis methods. The present study was designed to address these limitations by developing and validating a novel, fully generative probabilistic model for R-R interval time series. The results of our simulation studies and empirical application confirm our central hypothesis: the proposed framework provides a more robust, informative, and physiologically interpretable analysis of heart rate dynamics than conventional, windowed techniques. This discussion will interpret the significance of these findings, place them within the broader context of physiological modeling, acknowledge the model’s limitations, and outline promising directions for future research.</p>
<p>The primary contribution of this work is the demonstration of a model that successfully overcomes the principal obstacles in dynamic HRV analysis. The results from our simulation studies provide robust evidence for the model’s internal validity and inferential accuracy. Across multiple, challenging scenarios with known ground-truth dynamics, the model consistently recovered the underlying generative parameters with high precision, as evidenced by the posterior credible intervals that reliably contained the true values. Furthermore, the model accurately reconstructed the continuous, non-linear trajectories of both the mean RRi and its time-varying standard deviation, showcasing its ability to faithfully represent the signal’s evolution. This performance establishes a crucial foundation of trust in the model’s mechanics and its capacity to make accurate inferences from complex data.</p>
<p>Building upon this validation, the direct benchmarking against conventional methods highlighted the practical advantages of our approach. The quantitative analyses, which demonstrated consistently lower Root Mean Squared Error (RMSE) and higher coefficients of determination (<span class="math inline">\(R^2\)</span>) for our model, provide objective evidence of its superior accuracy in tracking dynamic signals. This superiority stems directly from the model’s architecture, which meets the four critical criteria outlined in the introduction. First, it explicitly models non-stationarity, obviating the need for arbitrary analysis windows. Second, it performs a mechanistic decomposition of the signal into a baseline trend, structured variability, and residual noise. Third, its parameters are designed for direct physiological interpretation. Finally, its implementation within a Bayesian framework provides principled and robust uncertainty quantification for all estimates. The successful fulfillment of these criteria represents a significant step towards a more powerful and nuanced analysis of physiological signals.</p>
<section id="methodological-superiority-and-the-abandonment-of-stationarity" class="level2">
<h2 class="anchored" data-anchor-id="methodological-superiority-and-the-abandonment-of-stationarity">Methodological superiority and the abandonment of stationarity</h2>
<p>A central argument of this paper is that the limitations of traditional HRV analysis are not merely technical but are conceptual, rooted in the flawed assumption of signal stationarity. Our results provide a clear illustration of why this assumption is so problematic. Windowed methods, whether for time-domain or frequency-domain analysis, are fundamentally signal processing filters. A sliding-window calculation of the mean or standard deviation, for instance, acts as a low-pass filter on the true underlying dynamic trajectory. This process inherently introduces artifacts: it blunts the magnitude of rapid changes, creates artificial delays in their detection, and produces a stepwise output that misrepresents the smooth nature of physiological regulation. The comparison in our results, where the windowed SDNN estimate lagged behind and smoothed over the true recovery dynamic, provides a stark example of this distortion.</p>
<p>A similar and well-documented issue plagues windowed spectral analysis, such as the Short-Time Fourier Transform (STFT). The STFT is constrained by the Heisenberg-Gabor uncertainty principle, which dictates an inescapable trade-off between temporal and frequency resolution. Short analysis windows can pinpoint the timing of spectral changes but produce noisy and poorly resolved frequency estimates; long windows provide cleaner spectral estimates but cannot precisely locate them in time. This limitation was evident in our benchmarking results, where the STFT produced a smeared and ambiguous representation of the rapid sympatho-vagal shift that our model resolved with high precision.</p>
<p>Our model circumvents these issues by reframing the problem from one of signal processing to one of statistical inference. Instead of filtering the data to reveal its properties, the model posits a generative process with an explicit mathematical structure, the double-logistic function, and infers the parameters of that process from the data. Because the model has a formal representation for the entire time-course of the physiological response, it is not constrained by the localizing limitations of a window. It uses information from the entire time series to inform its estimate at any single point, allowing it to simultaneously achieve high resolution in both the time and frequency domains. This fundamental shift from a descriptive, filtering approach to a generative, inferential one is the core reason for its demonstrated methodological superiority.</p>
</section>
<section id="physiological-and-clinical-significance-of-the-models-parameters" class="level2">
<h2 class="anchored" data-anchor-id="physiological-and-clinical-significance-of-the-models-parameters">Physiological and clinical significance of the model’s parameters</h2>
<p>The true value of this modeling framework lies not only in its improved accuracy but in its ability to yield deeper physiological insight. Traditional HRV metrics provide descriptive summaries of the signal, whereas the model’s parameters offer a more mechanistic, quantitative narrative of the underlying autonomic processes. This transition from description to mechanism has significant implications for both basic physiological research and potential clinical applications.</p>
<p>A key area of innovation is the model’s detailed quantification of recovery dynamics. Standard analysis might report that HRV returned to baseline after a certain time, but our model deconstructs this recovery into distinct, interpretable components. The parameters for recovery rate (<span class="math inline">\(\phi\)</span>), delay (<span class="math inline">\(\delta\)</span>), and completeness (<span class="math inline">\(c_s\)</span>, <span class="math inline">\(c_c\)</span>) allow for a multi-dimensional assessment of autonomic resilience. For example, the model could distinguish between an individual with a rapid but incomplete recovery and one with a slow but complete recovery, a nuance entirely lost to traditional methods. The ability to separately quantify the recovery completeness of the mean R-R interval (<span class="math inline">\(c_r\)</span>), total variability (<span class="math inline">\(c_s\)</span>), and spectral balance (<span class="math inline">\(c_c\)</span>) could be particularly powerful. A finding of dissonant recovery, for instance, a rapid return of heart rate to baseline but a persistently suppressed HRV, could serve as a sensitive marker for lingering sympathetic activation or impaired parasympathetic reactivation, concepts central to stress physiology and cardiovascular health.</p>
<p>Furthermore, the introduction of the structured variance fraction, <span class="math inline">\(w\)</span>, opens a new avenue for interpreting the <em>nature</em> of heart rate variability. This parameter quantifies the balance between coherent, physiologically structured oscillations and unstructured, residual noise. A high value of <span class="math inline">\(w\)</span> would suggest a state where the majority of variability is driven by well-organized autonomic regulation, whereas a low value could indicate a breakdown of this regulation, a pathological state, or a high degree of measurement noise. This parameter may therefore provide a novel index of autonomic coherence. For instance, in clinical contexts, a chronically low <span class="math inline">\(w\)</span> could be a marker for conditions like atrial fibrillation or other dysautonomias where the RRi signal becomes more erratic. In sports science, tracking <span class="math inline">\(w\)</span> could help distinguish between the healthy, structured variability of a well-recovered athlete and the potentially noisy, less structured variability of an over-trained one. These novel parameters, taken together, provide a richer and more granular toolkit for interrogating physiological states.</p>
</section>
<section id="limitations-and-considerations-for-future-work" class="level2">
<h2 class="anchored" data-anchor-id="limitations-and-considerations-for-future-work">Limitations and considerations for future work</h2>
<p>Despite its advantages, the proposed model is not without limitations, and an honest appraisal of these is essential for guiding future research. The first and most practical limitation is its computational demand. Full Bayesian inference via Markov chain Monte Carlo is an intensive process, requiring substantially more time and computational resources than conventional algorithms. This currently limits the model’s utility for real-time applications or for the analysis of very large-scale datasets with thousands of subjects.</p>
<p>Second, the model’s architecture relies on specific structural assumptions. The choice of the double-logistic function to represent the perturbation-recovery dynamic is central to the model’s interpretability. While this function is highly flexible and well-suited for the acute, transient stressors investigated here, it is by no means a universal model for all physiological dynamics. More complex, multi-phasic responses or long-term phenomena like circadian rhythms would not be well-captured by this specific functional form. Similarly, the spectral component of the model assumes that the signal can be effectively represented by a sum of sinusoids within pre-defined frequency bands. While this is a standard and powerful approach, it remains a model of the underlying spectral density and is constrained by the choice of those fixed frequencies.</p>
<p>Finally, the scope of the model’s validation must be considered. The current study demonstrated the model’s efficacy on simulated data and provided a proof-of-concept application on a single, acute physiological stressor. Its generalizability to other contexts has not yet been established. The model’s performance on different types of physiological challenges, such as orthostatic stress, cognitive load, or pharmacological interventions, requires explicit investigation. Moreover, its application to long-term, 24-hour ambulatory recordings presents both a significant opportunity and a challenge, as such data often contain multiple, overlapping events and distinct physiological states (e.g., wakefulness, sleep) that would require extensions to the current model structure.</p>
</section>
<section id="future-directions" class="level2">
<h2 class="anchored" data-anchor-id="future-directions">Future directions</h2>
<p>The limitations of the current model naturally illuminate several promising avenues for future research. To address the issue of fixed functional forms, the double-logistic component could be replaced with more flexible, non-parametric alternatives, such as Gaussian processes or penalized splines. This would create a semi-parametric model capable of capturing a much wider array of dynamic shapes, albeit potentially at the cost of some of the direct parameter interpretability. To enhance the model’s explanatory power and move towards subject-level inference, it could be extended into a hierarchical or mixed-effects framework. In such a model, key parameters like recovery rates or response magnitudes could be modeled as functions of subject-level covariates, such as age, sex, disease status, or fitness level, allowing for formal statistical testing of group differences in autonomic dynamics.</p>
<p>A clear priority for future work is the broad application and validation of the model across diverse datasets. Applying the model to existing clinical cohorts, for example, in studies of post-myocardial infarction risk stratification or diabetic autonomic neuropathy, could reveal whether its novel parameters offer superior prognostic value compared to traditional HRV metrics. Furthermore, deploying the model to analyze data from controlled interventions, such as exercise training programs or mindfulness-based stress reduction, would allow for a mechanistic quantification of how these interventions reshape autonomic function. On the computational front, the development of efficient approximate inference techniques, such as variational Bayes, could drastically reduce runtime and make the model a more practical tool for large-scale research and, eventually, clinical use.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This study introduced and validated a novel generative framework for the analysis of non-stationary R-R interval signals. By moving beyond the restrictive assumptions of traditional methods, our model provides a more accurate, detailed, and mechanistically interpretable view of heart rate dynamics. The results demonstrate its ability to not only overcome the artifacts associated with windowed analysis but also to furnish a new set of parameters that quantify distinct aspects of autonomic control, such as the completeness and rate of physiological recovery. While further validation and extension are necessary, we believe this work represents a significant step forward. It helps to shift the paradigm of physiological signal analysis away from a reliance on descriptive, summary statistics and towards a more powerful and insightful science of mechanistic, probabilistic inference.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" role="list">

</div>
</section>
<section id="author-contributions" class="level1">
<h1>Author Contributions</h1>
<p>Conceptualization, MC-A, CN-E; Data curation, MC-A; Investigation, MC-A; Methodology, MC-A; Supervision, CN-E; Formal analysis, MC-A; Visualization, MC-A; Writing–original draft, MC-A, CN-E; Writing–review &amp; editing, MC-A, […], CN-E. All authors have read and agreed to the published version of the manuscript.</p>
</section>
<section id="funding" class="level1">
<h1>Funding</h1>
<p>This work was funded by ANID Proyecto Fondecyt Regular Nº1250474 and by the Innovation Fund for Competitiveness of the Regional Government of Magallanes and Chilean Antarctica (BIP Code 40042452-0).</p>
</section>
<section id="data-availability-statement" class="level1">
<h1>Data availability statement</h1>
<p>The raw data supporting the conclusions of this article will be made available by the authors without undue reservation.</p>
</section>
<section id="conflicts-of-interests" class="level1">
<h1>Conflicts of interests</h1>
<p>The authors declare that the research was conducted without any commercial or financial relationships construed as as a potential conflict of interest.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>